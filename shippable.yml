build_image: shippableimages/ubuntu1404_base

# Cache the container for subsequent builds
cache: true

# Keep and archive of artifacts
archive: true

install:
  - sudo apt-get update
  - sudo apt-get -y install mono-complete xsltproc curl
  - mozroots --import --sync
  - curl -LO http://nuget.org/nuget.exe

before_script:
  - mkdir -p shippable/testresults

script:
  - mono nuget.exe restore
  - xbuild /target:Clean
  - xbuild TestNuGetAndShippable.sln
  - cp -a TestNuGetAndShippable/bin/Debug shippable/output
  - mono "$(ls -d packages/NUnit.Runners.* | tail -n 1)/tools/nunit-console.exe" tests/bin/Debug/tests.dll

after_script:
  - xsltproc nunit-to-junit.xsl TestResult.xml > shippable/testresults/TestResult.xml
